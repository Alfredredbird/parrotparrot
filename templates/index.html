<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Scanner Results</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #121212; /* Dark background */
            color: #ffffff; /* Light text */
        }
        .card {
            background-color: #1e1e1e; /* Dark card background */
            border: none; /* No border */
        }
        .card-header {
            background-color: #333; /* Darker card header */
            color: #ffffff; /* Light text */
        }
        table {
            color: #ffffff; /* Light text for table */
        }
        .table thead th {
            background-color: #333; /* Darker header background */
        }
        .table tbody tr:nth-child(even) {
            background-color: #2a2a2a; /* Slightly lighter row for even rows */
        }
        .table tbody tr:nth-child(odd) {
            background-color: #1e1e1e; /* Darker row for odd rows */
        }
        .mt-2 {
            color: #ffffff; /* Light text for average ping */
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">IP Scanner Results</h1>
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Status Codes
                    </div>
                    <div class="card-body">
                        <canvas id="statusChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Open Ports
                    </div>
                    <div class="card-body">
                        <canvas id="portChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        Ping Times (ms)
                    </div>
                    <div class="card-body">
                        <canvas id="pingChart" height="200"></canvas>
                        <div class="mt-2 text-center" id="averagePing"></div> <!-- Display average ping here -->
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        Summary by Hour
                    </div>
                    <div class="card-body">
                        <canvas id="summaryHourChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        Unique Geolocations
                    </div>
                    <div class="card-body">
                        <canvas id="geoChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        SSL Certificates
                    </div>
                    <div class="card-body">
                        <canvas id="sslChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- New Card for Hostname Comparison -->
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        Hostname Comparison
                    </div>
                    <div class="card-body">
                        <canvas id="hostnameComparisonChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        Cities
                    </div>
                    <div class="card-body">
                        <canvas id="cityChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        ISPs
                    </div>
                    <div class="card-body">
                        <canvas id="ispChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mt-4">
                <div class="card">
                    <div class="card-header">
                        Unique Hostnames
                    </div>
                    <div class="card-body">
                        <canvas id="dnsChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        // Fetch IP data from the Flask API
        fetch('/api/ip_data')
            .then(response => response.json())
            .then(data => {
                const statusCounts = {};
                const portCounts = {};
                const pingTimes = [];
                const geoCounts = {};
                const dnsCounts = {};
                const hostnameCounts = { known: 0, unknown: 0 };
                const hourCounts = {};
                const cityCounts = {};   // New city count variable
                const ispCounts = {};    // New ISP count variable
                const sslCounts = { valid: 0, invalid: 0 };  // New SSL count variable
                // Process IP data for status and port statistics
                for (const ip in data) {
                    const status = data[ip].code;
                    statusCounts[status] = (statusCounts[status] || 0) + 1;
                    
                    if (data[ip].open_ports) {
                        data[ip].open_ports.forEach(port => {
                            portCounts[port] = (portCounts[port] || 0) + 1;
                        });
                    }
                    // Process city data
                    const city = data[ip].geolocation.city || 'Unknown';
                    cityCounts[city] = (cityCounts[city] || 0) + 1;

                    // Process ISP data
                    const isp = data[ip].geolocation.org || 'Unknown ISP';
                    ispCounts[isp] = (ispCounts[isp] || 0) + 1;

                    // Process SSL certificate validity
                    const sslCertificate = data[ip].ssl_certificate;
                    if (sslCertificate && sslCertificate.valid) {
                        sslCounts.valid++;
                    } else {
                        sslCounts.invalid++;
                    }
                    const pingTime = data[ip].ping_time;
                    if (pingTime !== null) {
                        pingTimes.push(pingTime);
                    }

                    // Process geolocation data
                    const geo = data[ip].geolocation.country || 'Unknown';
                    geoCounts[geo] = (geoCounts[geo] || 0) + 1;

                    // Process DNS data
                    const hostname = data[ip].dns_info.hostname || 'Unknown';
                    dnsCounts[hostname] = (dnsCounts[hostname] || 0) + 1;

                    // Count known and unknown hostnames
                    if (hostname !== "Unknown") {
                        hostnameCounts.known++;
                    } else {
                        hostnameCounts.unknown++;
                    }

                    // Process summary by hour
                    const hour = new Date(data[ip].timestamp).getHours(); // Assuming a timestamp is available
                    hourCounts[hour] = (hourCounts[hour] || 0) + 1;
                }

                // Calculate average ping time
                const averagePing = pingTimes.length > 0 ? (pingTimes.reduce((a, b) => a + b, 0) / pingTimes.length).toFixed(2) : 0;
                document.getElementById('averagePing').innerText = `Average Ping: ${averagePing} ms`;

                const cityChartCtx = document.getElementById('cityChart').getContext('2d');
                const cityChart = new Chart(cityChartCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(cityCounts),
                        datasets: [{
                            label: 'Cities',
                            data: Object.values(cityCounts),
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            
                const ispChartCtx = document.getElementById('ispChart').getContext('2d');
                const ispChart = new Chart(ispChartCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(ispCounts),
                        datasets: [{
                            label: 'ISPs',
                            data: Object.values(ispCounts),
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            
                const sslChartCtx = document.getElementById('sslChart').getContext('2d');
                const sslChart = new Chart(sslChartCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Valid', 'Invalid'],
                        datasets: [{
                            data: [sslCounts.valid, sslCounts.invalid],
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.5)',
                                'rgba(255, 99, 132, 0.5)'
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    }
                });
  
                // Create chart for status codes
                const statusChartCtx = document.getElementById('statusChart').getContext('2d');
                const statusChart = new Chart(statusChartCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(statusCounts),
                        datasets: [{
                            label: 'Status Codes',
                            data: Object.values(statusCounts),
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Create chart for open ports
                const portChartCtx = document.getElementById('portChart').getContext('2d');
                const portChart = new Chart(portChartCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(portCounts),
                        datasets: [{
                            label: 'Open Ports',
                            data: Object.values(portCounts),
                            backgroundColor: 'rgba(153, 102, 255, 0.5)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Create chart for ping times
                const pingChartCtx = document.getElementById('pingChart').getContext('2d');
                const pingChart = new Chart(pingChartCtx, {
                    type: 'line',
                    data: {
                        labels: pingTimes.map((_, index) => `IP ${index + 1}`),
                        datasets: [{
                            label: 'Ping Times (ms)',
                            data: pingTimes,
                            fill: false,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Create chart for summary by hour
                const summaryHourChartCtx = document.getElementById('summaryHourChart').getContext('2d');
                const summaryHourChart = new Chart(summaryHourChartCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({ length: 24 }, (_, i) => i), // 0-23 hours
                        datasets: [{
                            label: 'Summary by Hour',
                            data: Array.from({ length: 24 }, (_, i) => hourCounts[i] || 0),
                            fill: false,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Create chart for unique geolocations
                const geoChartCtx = document.getElementById('geoChart').getContext('2d');
                const geoChart = new Chart(geoChartCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(geoCounts),
                        datasets: [{
                            label: 'Unique Geolocations',
                            data: Object.values(geoCounts),
                            backgroundColor: [
                                'rgba(255, 206, 86, 0.2)',
                                'rgba(75, 192, 192, 0.2)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 99, 132, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    }
                });

                // Create chart for unique hostnames
                const dnsChartCtx = document.getElementById('dnsChart').getContext('2d');
                const dnsChart = new Chart(dnsChartCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(dnsCounts),
                        datasets: [{
                            label: 'Unique Hostnames',
                            data: Object.values(dnsCounts),
                            backgroundColor: 'rgba(255, 159, 64, 0.5)',
                            borderColor: 'rgba(255, 159, 64, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Create chart for hostname comparison
                const hostnameComparisonChartCtx = document.getElementById('hostnameComparisonChart').getContext('2d');
                const hostnameComparisonChart = new Chart(hostnameComparisonChartCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Known', 'Unknown'],
                        datasets: [{
                            data: [hostnameCounts.known, hostnameCounts.unknown],
                            backgroundColor: [
                                'rgba(75, 192, 192, 0.5)',
                                'rgba(255, 99, 132, 0.5)'
                            ],
                            borderColor: [
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 99, 132, 1)'
                            ],
                            borderWidth: 1
                        }]
                    }
                });
            });
    </script>
</body>
</html>
